<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="schettino72">
    <title>strace &amp; build-tools | Rounder Wheels</title>
    
            <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
            <link href="../assets/css/custom.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
        <link rel="alternate" type="application/rss+xml" title="RSS (en)" href="http://feeds.feedburner.com/schettino72">

    



    
</head>
<body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../">Rounder Wheels</a>
    </div>
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
            
                <li><a href="../archive/index.html">Archives</a>
                </li><li><a href="../categories/index.html">Tags</a>

        </li></ul>

        <ul class="nav navbar-nav navbar-right">
            
            
                
    <li>
    <a href="strace-build-tools.md" id="sourcelink">Source</a>
    </li>

        </ul>
    </div><!-- /.navbar-collapse -->
  </div>
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
            
    <article class="postbox">
    
    <h1 class="p-name" itemprop="headline name">strace &amp; build-tools</h1>

    <hr>
    <small>
        Posted: <time class="published" datetime="2013-01-11T05:00:00+00:00">2013-01-11</time>
        

        
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../categories/python.html"><span class="badge badge-info">python</span></a>
        <a class="tag p-category" href="../categories/doit.html"><span class="badge badge-info">doit</span></a>
    </span>


    </small>
    <hr>
    <div><p><a href="https://en.wikipedia.org/wiki/Strace">strace</a> is a utility to monitor
system calls. I.e. it can report all files open by a process.</p>
<p><a href="https://code.google.com/p/fabricate/">fabricate.py</a>
is a build-tool based on strace.
The idea is pretty cool. It will execute all commands through strace.
Than it can automatically figure out the dependencie and targets
by looking at the strace output.
So you don't need to explicitly specifying the dependencies and targets.</p>
<p>But these approach has a few problems:</p>
<ul>
<li>strace will slow down the execution</li>
</ul>
<p>(not only because of strace itself but also becaue it will have
    to parse strace output)</p>
<ul>
<li>not always correct. i.e. <code>run('cp', '-r', 'src', 'out')</code></li>
</ul>
<p>If you just add a file to the <code>src</code> it can not figure out that a "dependency"
   was added.</p>
<ul>
<li>confuse targets &amp; dependencies</li>
</ul>
<p>It checks the mode files were open, if open in write mode it is <em>target</em>.
   The problem is that some programs have their own cache system,
   so a target might be taken as a dependency.</p>
<p>Where these limitations are a problem or not depends on your use-case...</p>
<h4>doit &amp; strace</h4>
<p><a href="http://pydoit.org/">doit</a> takes a very different approach
to dependency handling.
All dependencies must be explicitly defined.</p>
<p><code>doit</code> doesn't support any kind of implicit dependency
but it now comes with a <code>strace</code> command that lets you easily check
which files are being used.</p>
<p>The idea is that you can use this feature while developing your tasks
and make sure you are setting the dependencies correctly.</p>
<p>Example:</p>
<div class="code"><pre><span class="k">def</span> <span class="nf">task_o</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">'actions'</span><span class="p">:</span> <span class="p">[</span><span class="s">'cp abc abc2'</span><span class="p">,</span> <span class="s">'touch xyz'</span><span class="p">]}</span>
</pre></div>


<div class="code"><pre><span class="err">$</span> <span class="n">doit</span> <span class="n">strace</span> <span class="o">-</span><span class="n">f</span> <span class="n">traceme</span><span class="o">.</span><span class="n">py</span> <span class="n">o</span>
<span class="o">.</span>  <span class="n">o</span>
<span class="o">.</span>  <span class="n">strace_report</span>
<span class="n">R</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc2</span>
<span class="n">R</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc</span>
<span class="n">W</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc2</span>
<span class="n">W</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">xyz</span>
</pre></div>


<p>For more details check the <a href="http://pydoit.org/cmd_other.html#strace">docs</a>.</p></div>
    
    <ul class="pager">
        <li class="previous">
            <a href="python-code-coverage-multiprocessing.html" rel="prev">← Previous post</a>
        </li>
        <li class="next">
            <a href="mongodb-setup-deployd-heroku.html" rel="next">Next post →</a>
        </li>
    </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="schettino72blog",
            disqus_url="http://blog.schettino72.net/posts/strace-build-tools.html",
        disqus_title="strace & build-tools",
        disqus_identifier="_cache/_posts/strace-build-tools.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

        <!--End of body content-->
    </div>
</div>

<div class="container">
        <footer>
            Contents © 2012 schettino72 - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
        </footer>
</div>


            <script src="../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
            <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script>


    

    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36931321-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>