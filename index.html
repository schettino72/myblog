<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="title" content="Rounder Wheels | Rounder Wheels"><meta name="description" content="on programming"><meta name="author" content="schettino72"><title>Rounder Wheels | Rounder Wheels</title><!-- Le styles --><link href="assets/css/bootstrap.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/slides.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><link href="assets/css/custom.css" rel="stylesheet" type="text/css"><link href="assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css"><script src="assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script src="assets/js/slides.min.jquery.js" type="text/javascript"></script><script src="assets/js/bootstrap.min.js" type="text/javascript"></script><!-- Le HTML5 shim, for IE6-8 support of HTML5 elements --><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS (en)" href="http://feeds.feedburner.com/schettino72"></head><body>
  <div class="container-fluid" id="container">
    <div class="row-fluid">
      <!-- top header -->
      <div class="span12" id="titlecolumn">
        <h1 id="blog-title">
          <a href="." title="Rounder Wheels">Rounder Wheels</a>
          <small>  by <a href="#">schettino72</a></small>
        </h1>
        
        <hr></div>

      <!-- content -->
      <div class="row-fluid" id="contentrow">
        <div class="span10" id="contentcolumn">
          <!--Body content-->
          
        <div class="postbox">
        <h1><a href="posts/javascript-html-generation.html">generating HTML with javascript</a>
        <small>  
             2013-01-29
        </small></h1>
        
            <a class="tag" href="categories/javascript.html"><span class="badge badge-info">javascript</span></a>
            <a class="tag" href="categories/hoejs.html"><span class="badge badge-info">hoe.js</span></a>

        <hr><div><p>I often hear people saying something like
"HTML must be created using a template engine, anything else is a bad practice".
I will try to demystify this <em>dogma</em>...</p>
<h3>HTML</h3>
<p>HTML is a <em>text</em> document. But browsers don't handle the <em>text</em> directly.
It is first converted to DOM (document object model).
So HTML is more like a declarative way to describe a user interface program.</p>
<p>This is a very important distinction, one is <strong>text</strong> the other is an <strong>object</strong>
in a system.</p>
<p>Most components (HTML tags) simply describe how to display some data but other
are actual UI components.
For example a link (<code>a</code> tag) has an associated interaction with the user,
but being part of the standard the browser already knows how to handle it.
You don't need to write code for it, you just need to declare its <code>href</code>...</p>
<h3>server-side templates</h3>
<p>At some point the web moved from static HTML pages to dynamically generated
HTML by the server side. After some time people realized that mixing <em>text</em>
generation in the code could get quite messy. So they started using template
engines.</p>
<p>A template engines combine a template with some data source to create a HTML <em>text</em> document.</p>
<p>Nowadays it is pretty much an established consensus that when generating HTML on
the servers-side you should use a template engine,
and I agree that's the right thing to do.</p>
<h3>javascript templates</h3>
<p>As the web evolved the code started to move from server to client.
And the templates came together...</p>
<p>But wait. The server has no access to the DOM it can only create HTML <em>text</em>.
Javascript has direct access to the DOM!</p>
<p>Should we <em>always</em> programmatically write some <em>text</em> in a declarative interface
to create some UI components? Why not directly create these UI objects?</p>
<h3>comparison</h3>
<p>Lets compare different ways to modify the DOM using javascript
to generate the content <code>&lt;div&gt;Hello there&lt;/div&gt;</code>.</p>
<p>1) using DOM API</p>
<div class="code"><pre><span class="kd">var</span> <span class="nx">myDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">myContent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s2">"Hello there!"</span><span class="p">);</span>
<span class="nx">myDiv</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">myContent</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">myDiv</span><span class="p">);</span>
</pre></div>


<p>Note this is not writing HTML <em>text</em> (although sometimes we may call it this way).
It is manipulating the DOM directly. Oh, yes, it sucks :)</p>
<p>2) using jQuery</p>
<div class="code"><pre><span class="nx">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'&lt;div&gt;Hello there!&lt;/div&gt;'</span><span class="p">));</span>
</pre></div>


<p>That's funny, even that we are manipulating the DOM directly you must write HTML markup.</p>
<p>3) another DOM API (<a href="http://hoejs.schettino72.net/">hoe.js</a>)</p>
<div class="code"><pre><span class="nx">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">div</span><span class="p">(</span><span class="s1">'Hello there!'</span><span class="p">));</span>
</pre></div>


<p>That looks more reasonable.</p>
<p>4) using templates (<a href="http://handlebarsjs.com/">Handlebars</a>)</p>
<div class="code"><pre><span class="nx">template</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s2">"&lt;div&gt;{{content}}&lt;/div&gt;"</span><span class="p">)</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">template</span><span class="p">({</span><span class="nx">content</span><span class="o">:</span> <span class="s1">'Hello there!'</span><span class="p">}));</span>
</pre></div>


<p>This example is too contrived, normally you would put the template
in a <code>script</code> tag.</p>
<h3>declarative vs imperative</h3>
<p>So which one is better? The answer is, of course, it depends...</p>
<p>Declarative is good for data. If you are just laying out the structure
for some data, and using some existing UI component (HTML-tag).
Using a template you will get a much more readable code.</p>
<p>example (handlebars):</p>
<div class="code"><pre><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"people_list"</span><span class="nt">&gt;</span>
  {{#each people}}
  <span class="nt">&lt;li&gt;</span>{{this}}<span class="nt">&lt;/li&gt;</span>
  {{/each}}
<span class="nt">&lt;/ul&gt;</span>
</pre></div>


<p>Declarative is also good if you are just using some custom component.
In the example bellow a framework/library would look for elements
with a <code>class</code> attribute indicating the widget to be used and
the <code>data-</code> attributes to configure it.</p>
<div class="code"><pre><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"widget-XYZ"</span> <span class="na">data-opt-a=</span><span class="s">"5"</span><span class="nt">&gt;</span>
   some content
<span class="nt">&lt;/ul&gt;</span>
</pre></div>


<p>Template has a big disadvantage, it produces <em>text</em> and
loses the direct access to the DOM
that is available from javascript.</p>
<p>When the web "moved" from server to the client the default UI
elements provided by HTML were not enough to provide a rich user experience.
So developers often need to create new UI components in javascript.</p>
<p>If you are <strong>creating</strong> a new UI component where
you need to specify the behavior for a click and other actions you must
manipulate the object in the DOM because you need to attach events.</p>
<p>example (hoe.js):</p>
<div class="code"><pre><span class="kd">var</span> <span class="nx">myComponent</span> <span class="o">=</span> <span class="nx">div</span><span class="p">(</span><span class="s1">'click me'</span><span class="p">);</span>
<span class="nx">myComponent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">alert</span><span class="p">(</span><span class="s1">'Hello there!'</span><span class="p">)});</span>
</pre></div>


<p>So in one way or another you will have to get back a reference to the created
object. If you use a template this is usually done by a CSS selector.</p>
<p>Using a CSS selector is bad for many reasons. It might be slow (need to search
in the DOM). The code is error prone because it depends on attribute values
that are far away from the code. The selectors have two meanings
(styling with CSS and reference in javascript) that can gets confusing.</p>
<p>Another choice would be that your template/HTML reference the javascript code.
For very simple things this was always possible using <code>onclick</code> and other
attributes for events. Some frameworks provide more sophisticated mechanism like
associating with a "controller", etc.
The problem with this approach is that it doesn't scale as your component evolves.
When it gets more complex you try to stuff more logic in the template.
When your template can't handle it anymore you need to <em>throw away</em> your template
and re-write it in javascript...</p>
<h3>conclusion</h3>
<p>If you are <strong>creating</strong> an UI component, manipulating the DOM from javascript
is probably your best option.</p>
<p>If you are just filling some data and <strong>using</strong> existing components, templates
are probably better for you.</p></div>
        
    <p>
        <a href="posts/javascript-html-generation.html#disqus_thread" data-disqus-identifier="_cache/_posts/javascript-html-generation.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/mongodb-setup-deployd-heroku.html">mongodb setup for deployd on heroku</a>
        <small>  
             2013-01-27
        </small></h1>
        
            <a class="tag" href="categories/nodejs.html"><span class="badge badge-info">node.js</span></a>
            <a class="tag" href="categories/mongodb.html"><span class="badge badge-info">mongodb</span></a>

        <hr><div><p>I am using <a href="http://deployd.com/">deployd</a> to prototype an applicaton.
It's been great, really helped me focus on what matters for the prototype.</p>
<p>Today I reached the first milestone and decided to deploy it in
<a href="http://www.heroku.com/">heroku</a>.</p>
<p>I had a small problem because <em>deployd</em> uses an object to config <em>mongodb</em>,
but <em>heroku</em> provides only a URL to mongodb server...
So here is the script I am using to run <em>deployd</em> on <em>heroku</em>:</p>
<div class="code"><pre><span class="kd">var</span> <span class="nx">deployd</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'deployd'</span><span class="p">);</span>

<span class="c1">// on heroku must use port from env</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">db_url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGOHQ_URL</span> <span class="o">||</span> <span class="s2">"mongodb://:@localhost:27017/my_db_name"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">port</span><span class="o">:</span> <span class="nx">port</span><span class="p">,</span>
    <span class="nx">db</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"host"</span><span class="o">:</span> <span class="nx">db_url</span><span class="p">.</span><span class="nx">hostname</span><span class="p">,</span>
        <span class="s2">"port"</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">db_url</span><span class="p">.</span><span class="nx">port</span><span class="p">),</span>
        <span class="s2">"name"</span><span class="o">:</span> <span class="nx">db_url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s2">"credentials"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">"username"</span><span class="o">:</span> <span class="nx">db_url</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">"password"</span><span class="o">:</span> <span class="nx">db_url</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">deployd</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'listening'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Server is listening on "</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Give the server a chance to return an error</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div></div>
        
    <p>
        <a href="posts/mongodb-setup-deployd-heroku.html#disqus_thread" data-disqus-identifier="_cache/_posts/deployd-heroku-mongo-setup.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/strace-build-tools.html">strace &amp; build-tools</a>
        <small>  
             2013-01-11
        </small></h1>
        
            <a class="tag" href="categories/python.html"><span class="badge badge-info">python</span></a>
            <a class="tag" href="categories/doit.html"><span class="badge badge-info">doit</span></a>

        <hr><div><p><a href="https://en.wikipedia.org/wiki/Strace">strace</a> is a utility to monitor
system calls. I.e. it can report all files open by a process.</p>
<p><a href="https://code.google.com/p/fabricate/">fabricate.py</a>
is a build-tool based on strace.
The idea is pretty cool. It will execute all commands through strace.
Than it can automatically figure out the dependencie and targets
by looking at the strace output.
So you don't need to explicitly specifying the dependencies and targets.</p>
<p>But these approach has a few problems:</p>
<ul><li>strace will slow down the execution</li>
</ul><p>(not only because of strace itself but also becaue it will have
    to parse strace output)</p>
<ul><li>not always correct. i.e. <code>run('cp', '-r', 'src', 'out')</code></li>
</ul><p>If you just add a file to the <code>src</code> it can not figure out that a "dependency"
   was added.</p>
<ul><li>confuse targets &amp; dependencies</li>
</ul><p>It checks the mode files were open, if open in write mode it is <em>target</em>.
   The problem is that some programs have their own cache system,
   so a target might be taken as a dependency.</p>
<p>Where these limitations are a problem or not depends on your use-case...</p>
<h3>doit &amp; strace</h3>
<p><a href="http://pydoit.org/">doit</a> takes a very different approach
to dependency handling.
All dependencies must be explicitly defined.</p>
<p><code>doit</code> doesn't support any kind of implicit dependency
but it now comes with a <code>strace</code> command that lets you easily check
which files are being used.</p>
<p>The idea is that you can use this feature while developing your tasks
and make sure you are setting the dependencies correctly.</p>
<p>Example:</p>
<div class="code"><pre><span class="k">def</span> <span class="nf">task_o</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">'actions'</span><span class="p">:</span> <span class="p">[</span><span class="s">'cp abc abc2'</span><span class="p">,</span> <span class="s">'touch xyz'</span><span class="p">]}</span>
</pre></div>


<div class="code"><pre><span class="err">$</span> <span class="n">doit</span> <span class="n">strace</span> <span class="o">-</span><span class="n">f</span> <span class="n">traceme</span><span class="o">.</span><span class="n">py</span> <span class="n">o</span>
<span class="o">.</span>  <span class="n">o</span>
<span class="o">.</span>  <span class="n">strace_report</span>
<span class="n">R</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc2</span>
<span class="n">R</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc</span>
<span class="n">W</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">abc2</span>
<span class="n">W</span> <span class="o">/</span><span class="n">xxx</span><span class="o">/</span><span class="n">xyz</span>
</pre></div>


<p>For more details check the <a href="http://pydoit.org/cmd_other.html#strace">docs</a>.</p></div>
        
    <p>
        <a href="posts/strace-build-tools.html#disqus_thread" data-disqus-identifier="_cache/_posts/strace-build-tools.html">Comments</a>

        </p></div>
    
<div>
<ul class="pager"><li class="next">
        <a href="index-1.html">Older posts →</a>
    </li>
</ul></div>

    
       <script type="text/javascript">var disqus_shortname="schettino72blog";(function(){var a=document.createElement("script");a.async=true;a.type="text/javascript";a.src="http://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)}());</script><!--End of body content--><hr><small>Contents © 2012 schettino72 - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a></small>
      </div>

      <!--Sidebar content-->
      <div class="span2" id="sidebar">
        <ul class="unstyled"><li>
  <a href="http://feeds.feedburner.com/schettino72?format=xml" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"></a> <a href="http://feeds.feedburner.com/schettino72?format=xml" rel="alternate" type="application/rss+xml">feed</a>
</li>
          <li>
            </li><li><a href="archive/index.html">Archives</a>
            </li><li><a href="categories/index.html">Tags</a>
</li>
          <li>
        </ul></div>
      <!--End of sidebar content-->

      
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36931321-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></div></div></div></body></html>